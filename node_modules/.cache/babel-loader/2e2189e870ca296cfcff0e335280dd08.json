{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useWeb3Context } from 'contexts/Web3Context';\nimport { useBridgeDirection } from 'hooks/useBridgeDirection';\nimport { combineRequestsWithExecutions, getExecutions, getRequests } from 'lib/history';\nimport { useEffect, useState } from 'react';\nexport const useUserHistory = () => {\n  _s();\n  const {\n    homeChainId,\n    foreignChainId,\n    getGraphEndpoint\n  } = useBridgeDirection();\n  const {\n    account\n  } = useWeb3Context();\n  const [transfers, setTransfers] = useState([]);\n  const [loading, setLoading] = useState(true);\n  useEffect(() => {\n    if (!account) {\n      setLoading(false);\n      return () => undefined;\n    }\n    let isSubscribed = true;\n    async function update() {\n      setTransfers();\n      setLoading(true);\n      const [{\n        requests: homeRequests\n      }, {\n        requests: foreignRequests\n      }] = await Promise.all([getRequests(account, getGraphEndpoint(homeChainId)), getRequests(account, getGraphEndpoint(foreignChainId))]);\n      const [{\n        executions: homeExecutions\n      }, {\n        executions: foreignExecutions\n      }] = await Promise.all([getExecutions(getGraphEndpoint(homeChainId), foreignRequests), getExecutions(getGraphEndpoint(foreignChainId), homeRequests)]);\n      const homeTransfers = combineRequestsWithExecutions(homeRequests, foreignExecutions, homeChainId, foreignChainId);\n      const foreignTransfers = combineRequestsWithExecutions(foreignRequests, homeExecutions, foreignChainId, homeChainId);\n      const allTransfers = [...homeTransfers, ...foreignTransfers].sort((a, b) => b.timestamp - a.timestamp);\n      if (isSubscribed) {\n        setTransfers(allTransfers);\n        setLoading(false);\n      }\n    }\n    update();\n    return () => {\n      isSubscribed = false;\n    };\n  }, [homeChainId, foreignChainId, account, getGraphEndpoint]);\n  return {\n    transfers,\n    loading\n  };\n};\n_s(useUserHistory, \"RhacVmH5pUFIxPPlwdyT7EItnVM=\", false, function () {\n  return [useBridgeDirection, useWeb3Context];\n});","map":{"version":3,"names":["useWeb3Context","useBridgeDirection","combineRequestsWithExecutions","getExecutions","getRequests","useEffect","useState","useUserHistory","_s","homeChainId","foreignChainId","getGraphEndpoint","account","transfers","setTransfers","loading","setLoading","undefined","isSubscribed","update","requests","homeRequests","foreignRequests","Promise","all","executions","homeExecutions","foreignExecutions","homeTransfers","foreignTransfers","allTransfers","sort","a","b","timestamp"],"sources":["/home/hightop/bahamas_bridge/omnibridge-ui/packages/dapp/src/hooks/useUserHistory.js"],"sourcesContent":["import { useWeb3Context } from 'contexts/Web3Context';\nimport { useBridgeDirection } from 'hooks/useBridgeDirection';\nimport {\n  combineRequestsWithExecutions,\n  getExecutions,\n  getRequests,\n} from 'lib/history';\nimport { useEffect, useState } from 'react';\n\nexport const useUserHistory = () => {\n  const { homeChainId, foreignChainId, getGraphEndpoint } =\n    useBridgeDirection();\n  const { account } = useWeb3Context();\n  const [transfers, setTransfers] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    if (!account) {\n      setLoading(false);\n      return () => undefined;\n    }\n    let isSubscribed = true;\n    async function update() {\n      setTransfers();\n      setLoading(true);\n      const [{ requests: homeRequests }, { requests: foreignRequests }] =\n        await Promise.all([\n          getRequests(account, getGraphEndpoint(homeChainId)),\n          getRequests(account, getGraphEndpoint(foreignChainId)),\n        ]);\n      const [\n        { executions: homeExecutions },\n        { executions: foreignExecutions },\n      ] = await Promise.all([\n        getExecutions(getGraphEndpoint(homeChainId), foreignRequests),\n        getExecutions(getGraphEndpoint(foreignChainId), homeRequests),\n      ]);\n      const homeTransfers = combineRequestsWithExecutions(\n        homeRequests,\n        foreignExecutions,\n        homeChainId,\n        foreignChainId,\n      );\n      const foreignTransfers = combineRequestsWithExecutions(\n        foreignRequests,\n        homeExecutions,\n        foreignChainId,\n        homeChainId,\n      );\n      const allTransfers = [...homeTransfers, ...foreignTransfers].sort(\n        (a, b) => b.timestamp - a.timestamp,\n      );\n      if (isSubscribed) {\n        setTransfers(allTransfers);\n        setLoading(false);\n      }\n    }\n\n    update();\n\n    return () => {\n      isSubscribed = false;\n    };\n  }, [homeChainId, foreignChainId, account, getGraphEndpoint]);\n\n  return { transfers, loading };\n};\n"],"mappings":";AAAA,SAASA,cAAc,QAAQ,sBAAsB;AACrD,SAASC,kBAAkB,QAAQ,0BAA0B;AAC7D,SACEC,6BAA6B,EAC7BC,aAAa,EACbC,WAAW,QACN,aAAa;AACpB,SAASC,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAE3C,OAAO,MAAMC,cAAc,GAAGA,CAAA,KAAM;EAAAC,EAAA;EAClC,MAAM;IAAEC,WAAW;IAAEC,cAAc;IAAEC;EAAiB,CAAC,GACrDV,kBAAkB,CAAC,CAAC;EACtB,MAAM;IAAEW;EAAQ,CAAC,GAAGZ,cAAc,CAAC,CAAC;EACpC,MAAM,CAACa,SAAS,EAAEC,YAAY,CAAC,GAAGR,QAAQ,CAAC,EAAE,CAAC;EAC9C,MAAM,CAACS,OAAO,EAAEC,UAAU,CAAC,GAAGV,QAAQ,CAAC,IAAI,CAAC;EAE5CD,SAAS,CAAC,MAAM;IACd,IAAI,CAACO,OAAO,EAAE;MACZI,UAAU,CAAC,KAAK,CAAC;MACjB,OAAO,MAAMC,SAAS;IACxB;IACA,IAAIC,YAAY,GAAG,IAAI;IACvB,eAAeC,MAAMA,CAAA,EAAG;MACtBL,YAAY,CAAC,CAAC;MACdE,UAAU,CAAC,IAAI,CAAC;MAChB,MAAM,CAAC;QAAEI,QAAQ,EAAEC;MAAa,CAAC,EAAE;QAAED,QAAQ,EAAEE;MAAgB,CAAC,CAAC,GAC/D,MAAMC,OAAO,CAACC,GAAG,CAAC,CAChBpB,WAAW,CAACQ,OAAO,EAAED,gBAAgB,CAACF,WAAW,CAAC,CAAC,EACnDL,WAAW,CAACQ,OAAO,EAAED,gBAAgB,CAACD,cAAc,CAAC,CAAC,CACvD,CAAC;MACJ,MAAM,CACJ;QAAEe,UAAU,EAAEC;MAAe,CAAC,EAC9B;QAAED,UAAU,EAAEE;MAAkB,CAAC,CAClC,GAAG,MAAMJ,OAAO,CAACC,GAAG,CAAC,CACpBrB,aAAa,CAACQ,gBAAgB,CAACF,WAAW,CAAC,EAAEa,eAAe,CAAC,EAC7DnB,aAAa,CAACQ,gBAAgB,CAACD,cAAc,CAAC,EAAEW,YAAY,CAAC,CAC9D,CAAC;MACF,MAAMO,aAAa,GAAG1B,6BAA6B,CACjDmB,YAAY,EACZM,iBAAiB,EACjBlB,WAAW,EACXC,cACF,CAAC;MACD,MAAMmB,gBAAgB,GAAG3B,6BAA6B,CACpDoB,eAAe,EACfI,cAAc,EACdhB,cAAc,EACdD,WACF,CAAC;MACD,MAAMqB,YAAY,GAAG,CAAC,GAAGF,aAAa,EAAE,GAAGC,gBAAgB,CAAC,CAACE,IAAI,CAC/D,CAACC,CAAC,EAAEC,CAAC,KAAKA,CAAC,CAACC,SAAS,GAAGF,CAAC,CAACE,SAC5B,CAAC;MACD,IAAIhB,YAAY,EAAE;QAChBJ,YAAY,CAACgB,YAAY,CAAC;QAC1Bd,UAAU,CAAC,KAAK,CAAC;MACnB;IACF;IAEAG,MAAM,CAAC,CAAC;IAER,OAAO,MAAM;MACXD,YAAY,GAAG,KAAK;IACtB,CAAC;EACH,CAAC,EAAE,CAACT,WAAW,EAAEC,cAAc,EAAEE,OAAO,EAAED,gBAAgB,CAAC,CAAC;EAE5D,OAAO;IAAEE,SAAS;IAAEE;EAAQ,CAAC;AAC/B,CAAC;AAACP,EAAA,CAzDWD,cAAc;EAAA,QAEvBN,kBAAkB,EACAD,cAAc;AAAA"},"metadata":{},"sourceType":"module"}