{"ast":null,"code":"import { createTransport } from '@sentry/core';\nimport { SyncPromise } from '@sentry/utils';\n/**\n * The DONE ready state for XmlHttpRequest\n *\n * Defining it here as a constant b/c XMLHttpRequest.DONE is not always defined\n * (e.g. during testing, it is `undefined`)\n *\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/readyState}\n */\nvar XHR_READYSTATE_DONE = 4;\n/**\n * Creates a Transport that uses the XMLHttpRequest API to send events to Sentry.\n */\nexport function makeNewXHRTransport(options) {\n  function makeRequest(request) {\n    return new SyncPromise(function (resolve, _reject) {\n      var xhr = new XMLHttpRequest();\n      xhr.onreadystatechange = function () {\n        if (xhr.readyState === XHR_READYSTATE_DONE) {\n          var response = {\n            body: xhr.response,\n            headers: {\n              'x-sentry-rate-limits': xhr.getResponseHeader('X-Sentry-Rate-Limits'),\n              'retry-after': xhr.getResponseHeader('Retry-After')\n            },\n            reason: xhr.statusText,\n            statusCode: xhr.status\n          };\n          resolve(response);\n        }\n      };\n      xhr.open('POST', options.url);\n      for (var header in options.headers) {\n        if (Object.prototype.hasOwnProperty.call(options.headers, header)) {\n          xhr.setRequestHeader(header, options.headers[header]);\n        }\n      }\n      xhr.send(request.body);\n    });\n  }\n  return createTransport({\n    bufferSize: options.bufferSize\n  }, makeRequest);\n}","map":{"version":3,"sources":["../../../../src/transports/new-xhr.ts"],"names":[],"mappings":"AAAA,SAEE,eAAe,QAIV,cAAc;AACrB,SAAS,WAAW,QAAQ,eAAe;AAE3C;;;;;;;AAOG;AACH,IAAM,mBAAmB,GAAG,CAAC;AAM7B;;AAEG;AACH,OAAM,SAAU,mBAAmB,CAAC,OAA4B,EAAA;EAC9D,SAAS,WAAW,CAAC,OAAyB,EAAA;IAC5C,OAAO,IAAI,WAAW,CAA+B,UAAC,OAAO,EAAE,OAAO,EAAA;MACpE,IAAM,GAAG,GAAG,IAAI,cAAc,CAAA,CAAE;MAEhC,GAAG,CAAC,kBAAkB,GAAG,YAAA;QACvB,IAAI,GAAG,CAAC,UAAU,KAAK,mBAAmB,EAAE;UAC1C,IAAM,QAAQ,GAAG;YACf,IAAI,EAAE,GAAG,CAAC,QAAQ;YAClB,OAAO,EAAE;cACP,sBAAsB,EAAE,GAAG,CAAC,iBAAiB,CAAC,sBAAsB,CAAC;cACrE,aAAa,EAAE,GAAG,CAAC,iBAAiB,CAAC,aAAa;aACnD;YACD,MAAM,EAAE,GAAG,CAAC,UAAU;YACtB,UAAU,EAAE,GAAG,CAAC;WACjB;UACD,OAAO,CAAC,QAAQ,CAAC;QAClB;MACH,CAAC;MAED,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC;MAE7B,KAAK,IAAM,MAAM,IAAI,OAAO,CAAC,OAAO,EAAE;QACpC,IAAI,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,MAAM,CAAC,EAAE;UACjE,GAAG,CAAC,gBAAgB,CAAC,MAAM,EAAE,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;QACtD;MACF;MAED,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;IACxB,CAAC,CAAC;EACJ;EAEA,OAAO,eAAe,CAAC;IAAE,UAAU,EAAE,OAAO,CAAC;EAAU,CAAE,EAAE,WAAW,CAAC;AACzE","sourcesContent":["import {\n  BaseTransportOptions,\n  createTransport,\n  NewTransport,\n  TransportMakeRequestResponse,\n  TransportRequest,\n} from '@sentry/core';\nimport { SyncPromise } from '@sentry/utils';\n\n/**\n * The DONE ready state for XmlHttpRequest\n *\n * Defining it here as a constant b/c XMLHttpRequest.DONE is not always defined\n * (e.g. during testing, it is `undefined`)\n *\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/readyState}\n */\nconst XHR_READYSTATE_DONE = 4;\n\nexport interface XHRTransportOptions extends BaseTransportOptions {\n  headers?: { [key: string]: string };\n}\n\n/**\n * Creates a Transport that uses the XMLHttpRequest API to send events to Sentry.\n */\nexport function makeNewXHRTransport(options: XHRTransportOptions): NewTransport {\n  function makeRequest(request: TransportRequest): PromiseLike<TransportMakeRequestResponse> {\n    return new SyncPromise<TransportMakeRequestResponse>((resolve, _reject) => {\n      const xhr = new XMLHttpRequest();\n\n      xhr.onreadystatechange = (): void => {\n        if (xhr.readyState === XHR_READYSTATE_DONE) {\n          const response = {\n            body: xhr.response,\n            headers: {\n              'x-sentry-rate-limits': xhr.getResponseHeader('X-Sentry-Rate-Limits'),\n              'retry-after': xhr.getResponseHeader('Retry-After'),\n            },\n            reason: xhr.statusText,\n            statusCode: xhr.status,\n          };\n          resolve(response);\n        }\n      };\n\n      xhr.open('POST', options.url);\n\n      for (const header in options.headers) {\n        if (Object.prototype.hasOwnProperty.call(options.headers, header)) {\n          xhr.setRequestHeader(header, options.headers[header]);\n        }\n      }\n\n      xhr.send(request.body);\n    });\n  }\n\n  return createTransport({ bufferSize: options.bufferSize }, makeRequest);\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}