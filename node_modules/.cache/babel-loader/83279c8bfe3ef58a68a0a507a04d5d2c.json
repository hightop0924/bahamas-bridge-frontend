{"ast":null,"code":"\"use strict\";\n\n// Copyright (c) 2018-2020 WalletLink.org <https://www.walletlink.org/>\n// Copyright (c) 2018-2020 Coinbase, Inc. <https://www.coinbase.com/>\n// Licensed under the Apache License, version 2.0\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.RxWebSocket = exports.ConnectionState = void 0;\nconst rxjs_1 = require(\"rxjs\");\nconst operators_1 = require(\"rxjs/operators\");\nvar ConnectionState;\n(function (ConnectionState) {\n  ConnectionState[ConnectionState[\"DISCONNECTED\"] = 0] = \"DISCONNECTED\";\n  ConnectionState[ConnectionState[\"CONNECTING\"] = 1] = \"CONNECTING\";\n  ConnectionState[ConnectionState[\"CONNECTED\"] = 2] = \"CONNECTED\";\n})(ConnectionState = exports.ConnectionState || (exports.ConnectionState = {}));\n/**\n * Rx-ified WebSocket\n */\nclass RxWebSocket {\n  /**\n   * Constructor\n   * @param url WebSocket server URL\n   * @param [WebSocketClass] Custom WebSocket implementation\n   */\n  constructor(url, WebSocketClass = WebSocket) {\n    this.WebSocketClass = WebSocketClass;\n    this.webSocket = null;\n    this.connectionStateSubject = new rxjs_1.BehaviorSubject(ConnectionState.DISCONNECTED);\n    this.incomingDataSubject = new rxjs_1.Subject();\n    this.url = url.replace(/^http/, \"ws\");\n  }\n  /**\n   * Make a websocket connection\n   * @returns an Observable that completes when connected\n   */\n  connect() {\n    if (this.webSocket) {\n      return (0, rxjs_1.throwError)(new Error(\"webSocket object is not null\"));\n    }\n    return new rxjs_1.Observable(obs => {\n      let webSocket;\n      try {\n        this.webSocket = webSocket = new this.WebSocketClass(this.url);\n      } catch (err) {\n        obs.error(err);\n        return;\n      }\n      this.connectionStateSubject.next(ConnectionState.CONNECTING);\n      webSocket.onclose = evt => {\n        this.clearWebSocket();\n        obs.error(new Error(`websocket error ${evt.code}: ${evt.reason}`));\n        this.connectionStateSubject.next(ConnectionState.DISCONNECTED);\n      };\n      webSocket.onopen = _ => {\n        obs.next();\n        obs.complete();\n        this.connectionStateSubject.next(ConnectionState.CONNECTED);\n      };\n      webSocket.onmessage = evt => {\n        this.incomingDataSubject.next(evt.data);\n      };\n    }).pipe((0, operators_1.take)(1));\n  }\n  /**\n   * Disconnect from server\n   */\n  disconnect() {\n    const {\n      webSocket\n    } = this;\n    if (!webSocket) {\n      return;\n    }\n    this.clearWebSocket();\n    this.connectionStateSubject.next(ConnectionState.DISCONNECTED);\n    try {\n      webSocket.close();\n    } catch (_a) {}\n  }\n  /**\n   * Emit current connection state and subsequent changes\n   * @returns an Observable for the connection state\n   */\n  get connectionState$() {\n    return this.connectionStateSubject.asObservable();\n  }\n  /**\n   * Emit incoming data from server\n   * @returns an Observable for the data received\n   */\n  get incomingData$() {\n    return this.incomingDataSubject.asObservable();\n  }\n  /**\n   * Emit incoming JSON data from server. non-JSON data are ignored\n   * @returns an Observable for parsed JSON data\n   */\n  get incomingJSONData$() {\n    return this.incomingData$.pipe((0, operators_1.flatMap)(m => {\n      let j;\n      try {\n        j = JSON.parse(m);\n      } catch (err) {\n        return (0, rxjs_1.empty)();\n      }\n      return (0, rxjs_1.of)(j);\n    }));\n  }\n  /**\n   * Send data to server\n   * @param data text to send\n   */\n  sendData(data) {\n    const {\n      webSocket\n    } = this;\n    if (!webSocket) {\n      throw new Error(\"websocket is not connected\");\n    }\n    webSocket.send(data);\n  }\n  clearWebSocket() {\n    const {\n      webSocket\n    } = this;\n    if (!webSocket) {\n      return;\n    }\n    this.webSocket = null;\n    webSocket.onclose = null;\n    webSocket.onerror = null;\n    webSocket.onmessage = null;\n    webSocket.onopen = null;\n  }\n}\nexports.RxWebSocket = RxWebSocket;","map":{"version":3,"names":["Object","defineProperty","exports","value","RxWebSocket","ConnectionState","rxjs_1","require","operators_1","constructor","url","WebSocketClass","WebSocket","webSocket","connectionStateSubject","BehaviorSubject","DISCONNECTED","incomingDataSubject","Subject","replace","connect","throwError","Error","Observable","obs","err","error","next","CONNECTING","onclose","evt","clearWebSocket","code","reason","onopen","_","complete","CONNECTED","onmessage","data","pipe","take","disconnect","close","_a","connectionState$","asObservable","incomingData$","incomingJSONData$","flatMap","m","j","JSON","parse","empty","of","sendData","send","onerror"],"sources":["/home/hightop/bahamas_bridge/omnibridge-ui/node_modules/walletlink/dist/connection/RxWebSocket.js"],"sourcesContent":["\"use strict\";\n// Copyright (c) 2018-2020 WalletLink.org <https://www.walletlink.org/>\n// Copyright (c) 2018-2020 Coinbase, Inc. <https://www.coinbase.com/>\n// Licensed under the Apache License, version 2.0\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.RxWebSocket = exports.ConnectionState = void 0;\nconst rxjs_1 = require(\"rxjs\");\nconst operators_1 = require(\"rxjs/operators\");\nvar ConnectionState;\n(function (ConnectionState) {\n    ConnectionState[ConnectionState[\"DISCONNECTED\"] = 0] = \"DISCONNECTED\";\n    ConnectionState[ConnectionState[\"CONNECTING\"] = 1] = \"CONNECTING\";\n    ConnectionState[ConnectionState[\"CONNECTED\"] = 2] = \"CONNECTED\";\n})(ConnectionState = exports.ConnectionState || (exports.ConnectionState = {}));\n/**\n * Rx-ified WebSocket\n */\nclass RxWebSocket {\n    /**\n     * Constructor\n     * @param url WebSocket server URL\n     * @param [WebSocketClass] Custom WebSocket implementation\n     */\n    constructor(url, WebSocketClass = WebSocket) {\n        this.WebSocketClass = WebSocketClass;\n        this.webSocket = null;\n        this.connectionStateSubject = new rxjs_1.BehaviorSubject(ConnectionState.DISCONNECTED);\n        this.incomingDataSubject = new rxjs_1.Subject();\n        this.url = url.replace(/^http/, \"ws\");\n    }\n    /**\n     * Make a websocket connection\n     * @returns an Observable that completes when connected\n     */\n    connect() {\n        if (this.webSocket) {\n            return (0, rxjs_1.throwError)(new Error(\"webSocket object is not null\"));\n        }\n        return new rxjs_1.Observable(obs => {\n            let webSocket;\n            try {\n                this.webSocket = webSocket = new this.WebSocketClass(this.url);\n            }\n            catch (err) {\n                obs.error(err);\n                return;\n            }\n            this.connectionStateSubject.next(ConnectionState.CONNECTING);\n            webSocket.onclose = evt => {\n                this.clearWebSocket();\n                obs.error(new Error(`websocket error ${evt.code}: ${evt.reason}`));\n                this.connectionStateSubject.next(ConnectionState.DISCONNECTED);\n            };\n            webSocket.onopen = _ => {\n                obs.next();\n                obs.complete();\n                this.connectionStateSubject.next(ConnectionState.CONNECTED);\n            };\n            webSocket.onmessage = evt => {\n                this.incomingDataSubject.next(evt.data);\n            };\n        }).pipe((0, operators_1.take)(1));\n    }\n    /**\n     * Disconnect from server\n     */\n    disconnect() {\n        const { webSocket } = this;\n        if (!webSocket) {\n            return;\n        }\n        this.clearWebSocket();\n        this.connectionStateSubject.next(ConnectionState.DISCONNECTED);\n        try {\n            webSocket.close();\n        }\n        catch (_a) { }\n    }\n    /**\n     * Emit current connection state and subsequent changes\n     * @returns an Observable for the connection state\n     */\n    get connectionState$() {\n        return this.connectionStateSubject.asObservable();\n    }\n    /**\n     * Emit incoming data from server\n     * @returns an Observable for the data received\n     */\n    get incomingData$() {\n        return this.incomingDataSubject.asObservable();\n    }\n    /**\n     * Emit incoming JSON data from server. non-JSON data are ignored\n     * @returns an Observable for parsed JSON data\n     */\n    get incomingJSONData$() {\n        return this.incomingData$.pipe((0, operators_1.flatMap)(m => {\n            let j;\n            try {\n                j = JSON.parse(m);\n            }\n            catch (err) {\n                return (0, rxjs_1.empty)();\n            }\n            return (0, rxjs_1.of)(j);\n        }));\n    }\n    /**\n     * Send data to server\n     * @param data text to send\n     */\n    sendData(data) {\n        const { webSocket } = this;\n        if (!webSocket) {\n            throw new Error(\"websocket is not connected\");\n        }\n        webSocket.send(data);\n    }\n    clearWebSocket() {\n        const { webSocket } = this;\n        if (!webSocket) {\n            return;\n        }\n        this.webSocket = null;\n        webSocket.onclose = null;\n        webSocket.onerror = null;\n        webSocket.onmessage = null;\n        webSocket.onopen = null;\n    }\n}\nexports.RxWebSocket = RxWebSocket;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}