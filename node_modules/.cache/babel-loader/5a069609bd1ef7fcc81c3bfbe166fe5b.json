{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = Object.setPrototypeOf || {\n    __proto__: []\n  } instanceof Array && function (d, b) {\n    d.__proto__ = b;\n  } || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n  };\n  return function (d, b) {\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar __assign = this && this.__assign || Object.assign || function (t) {\n  for (var s, i = 1, n = arguments.length; i < n; i++) {\n    s = arguments[i];\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n  }\n  return t;\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar http = require(\"http\");\nvar https = require(\"https\");\nvar os = require(\"os\");\nvar url = require(\"url\");\nvar progress_event_1 = require(\"./progress-event\");\nvar errors_1 = require(\"./errors\");\nvar xml_http_request_event_target_1 = require(\"./xml-http-request-event-target\");\nvar xml_http_request_upload_1 = require(\"./xml-http-request-upload\");\nvar Cookie = require(\"cookiejar\");\nvar XMLHttpRequest = /** @class */function (_super) {\n  __extends(XMLHttpRequest, _super);\n  function XMLHttpRequest(options) {\n    if (options === void 0) {\n      options = {};\n    }\n    var _this = _super.call(this) || this;\n    _this.UNSENT = XMLHttpRequest.UNSENT;\n    _this.OPENED = XMLHttpRequest.OPENED;\n    _this.HEADERS_RECEIVED = XMLHttpRequest.HEADERS_RECEIVED;\n    _this.LOADING = XMLHttpRequest.LOADING;\n    _this.DONE = XMLHttpRequest.DONE;\n    _this.onreadystatechange = null;\n    _this.readyState = XMLHttpRequest.UNSENT;\n    _this.response = null;\n    _this.responseText = '';\n    _this.responseType = '';\n    _this.status = 0; // TODO: UNSENT?\n    _this.statusText = '';\n    _this.timeout = 0;\n    _this.upload = new xml_http_request_upload_1.XMLHttpRequestUpload();\n    _this.responseUrl = '';\n    _this.withCredentials = false;\n    _this._method = null;\n    _this._url = null;\n    _this._sync = false;\n    _this._headers = {};\n    _this._loweredHeaders = {};\n    _this._mimeOverride = null; // TODO: is type right?\n    _this._request = null;\n    _this._response = null;\n    _this._responseParts = null;\n    _this._responseHeaders = null;\n    _this._aborting = null; // TODO: type?\n    _this._error = null; // TODO: type?\n    _this._loadedBytes = 0;\n    _this._totalBytes = 0;\n    _this._lengthComputable = false;\n    _this._restrictedMethods = {\n      CONNECT: true,\n      TRACE: true,\n      TRACK: true\n    };\n    _this._restrictedHeaders = {\n      'accept-charset': true,\n      'accept-encoding': true,\n      'access-control-request-headers': true,\n      'access-control-request-method': true,\n      connection: true,\n      'content-length': true,\n      cookie: true,\n      cookie2: true,\n      date: true,\n      dnt: true,\n      expect: true,\n      host: true,\n      'keep-alive': true,\n      origin: true,\n      referer: true,\n      te: true,\n      trailer: true,\n      'transfer-encoding': true,\n      upgrade: true,\n      'user-agent': true,\n      via: true\n    };\n    _this._privateHeaders = {\n      'set-cookie': true,\n      'set-cookie2': true\n    };\n    _this._userAgent = \"Mozilla/5.0 (\" + os.type() + \" \" + os.arch() + \") node.js/\" + process.versions.node + \" v8/\" + process.versions.v8;\n    _this._anonymous = options.anon || false;\n    return _this;\n  }\n  XMLHttpRequest.prototype.open = function (method, url, async, user, password) {\n    if (async === void 0) {\n      async = true;\n    }\n    method = method.toUpperCase();\n    if (this._restrictedMethods[method]) {\n      throw new XMLHttpRequest.SecurityError(\"HTTP method \" + method + \" is not allowed in XHR\");\n    }\n    ;\n    var xhrUrl = this._parseUrl(url, user, password);\n    if (this.readyState === XMLHttpRequest.HEADERS_RECEIVED || this.readyState === XMLHttpRequest.LOADING) {\n      // TODO(pwnall): terminate abort(), terminate send()\n    }\n    this._method = method;\n    this._url = xhrUrl;\n    this._sync = !async;\n    this._headers = {};\n    this._loweredHeaders = {};\n    this._mimeOverride = null;\n    this._setReadyState(XMLHttpRequest.OPENED);\n    this._request = null;\n    this._response = null;\n    this.status = 0;\n    this.statusText = '';\n    this._responseParts = [];\n    this._responseHeaders = null;\n    this._loadedBytes = 0;\n    this._totalBytes = 0;\n    this._lengthComputable = false;\n  };\n  XMLHttpRequest.prototype.setRequestHeader = function (name, value) {\n    if (this.readyState !== XMLHttpRequest.OPENED) {\n      throw new XMLHttpRequest.InvalidStateError('XHR readyState must be OPENED');\n    }\n    var loweredName = name.toLowerCase();\n    if (this._restrictedHeaders[loweredName] || /^sec-/.test(loweredName) || /^proxy-/.test(loweredName)) {\n      console.warn(\"Refused to set unsafe header \\\"\" + name + \"\\\"\");\n      return;\n    }\n    value = value.toString();\n    if (this._loweredHeaders[loweredName] != null) {\n      name = this._loweredHeaders[loweredName];\n      this._headers[name] = this._headers[name] + \", \" + value;\n    } else {\n      this._loweredHeaders[loweredName] = name;\n      this._headers[name] = value;\n    }\n  };\n  XMLHttpRequest.prototype.send = function (data) {\n    if (this.readyState !== XMLHttpRequest.OPENED) {\n      throw new XMLHttpRequest.InvalidStateError('XHR readyState must be OPENED');\n    }\n    if (this._request) {\n      throw new XMLHttpRequest.InvalidStateError('send() already called');\n    }\n    switch (this._url.protocol) {\n      case 'file:':\n        return this._sendFile(data);\n      case 'http:':\n      case 'https:':\n        return this._sendHttp(data);\n      default:\n        throw new XMLHttpRequest.NetworkError(\"Unsupported protocol \" + this._url.protocol);\n    }\n  };\n  XMLHttpRequest.prototype.abort = function () {\n    if (this._request == null) {\n      return;\n    }\n    this._request.abort();\n    this._setError();\n    this._dispatchProgress('abort');\n    this._dispatchProgress('loadend');\n  };\n  XMLHttpRequest.prototype.getResponseHeader = function (name) {\n    if (this._responseHeaders == null || name == null) {\n      return null;\n    }\n    var loweredName = name.toLowerCase();\n    return this._responseHeaders.hasOwnProperty(loweredName) ? this._responseHeaders[name.toLowerCase()] : null;\n  };\n  XMLHttpRequest.prototype.getAllResponseHeaders = function () {\n    var _this = this;\n    if (this._responseHeaders == null) {\n      return '';\n    }\n    return Object.keys(this._responseHeaders).map(function (key) {\n      return key + \": \" + _this._responseHeaders[key];\n    }).join('\\r\\n');\n  };\n  XMLHttpRequest.prototype.overrideMimeType = function (mimeType) {\n    if (this.readyState === XMLHttpRequest.LOADING || this.readyState === XMLHttpRequest.DONE) {\n      throw new XMLHttpRequest.InvalidStateError('overrideMimeType() not allowed in LOADING or DONE');\n    }\n    this._mimeOverride = mimeType.toLowerCase();\n  };\n  XMLHttpRequest.prototype.nodejsSet = function (options) {\n    this.nodejsHttpAgent = options.httpAgent || this.nodejsHttpAgent;\n    this.nodejsHttpsAgent = options.httpsAgent || this.nodejsHttpsAgent;\n    if (options.hasOwnProperty('baseUrl')) {\n      if (options.baseUrl != null) {\n        var parsedUrl = url.parse(options.baseUrl, false, true);\n        if (!parsedUrl.protocol) {\n          throw new XMLHttpRequest.SyntaxError(\"baseUrl must be an absolute URL\");\n        }\n      }\n      this.nodejsBaseUrl = options.baseUrl;\n    }\n  };\n  XMLHttpRequest.nodejsSet = function (options) {\n    XMLHttpRequest.prototype.nodejsSet(options);\n  };\n  XMLHttpRequest.prototype._setReadyState = function (readyState) {\n    this.readyState = readyState;\n    this.dispatchEvent(new progress_event_1.ProgressEvent('readystatechange'));\n  };\n  XMLHttpRequest.prototype._sendFile = function (data) {\n    // TODO\n    throw new Error('Protocol file: not implemented');\n  };\n  XMLHttpRequest.prototype._sendHttp = function (data) {\n    if (this._sync) {\n      throw new Error('Synchronous XHR processing not implemented');\n    }\n    if (data && (this._method === 'GET' || this._method === 'HEAD')) {\n      console.warn(\"Discarding entity body for \" + this._method + \" requests\");\n      data = null;\n    } else {\n      data = data || '';\n    }\n    this.upload._setData(data);\n    this._finalizeHeaders();\n    this._sendHxxpRequest();\n  };\n  XMLHttpRequest.prototype._sendHxxpRequest = function () {\n    var _this = this;\n    if (this.withCredentials) {\n      var cookie = XMLHttpRequest.cookieJar.getCookies(Cookie.CookieAccessInfo(this._url.hostname, this._url.pathname, this._url.protocol === 'https:')).toValueString();\n      this._headers.cookie = this._headers.cookie2 = cookie;\n    }\n    var _a = this._url.protocol === 'http:' ? [http, this.nodejsHttpAgent] : [https, this.nodejsHttpsAgent],\n      hxxp = _a[0],\n      agent = _a[1];\n    var requestMethod = hxxp.request.bind(hxxp);\n    var request = requestMethod({\n      hostname: this._url.hostname,\n      port: +this._url.port,\n      path: this._url.path,\n      auth: this._url.auth,\n      method: this._method,\n      headers: this._headers,\n      agent: agent\n    });\n    this._request = request;\n    if (this.timeout) {\n      request.setTimeout(this.timeout, function () {\n        return _this._onHttpTimeout(request);\n      });\n    }\n    request.on('response', function (response) {\n      return _this._onHttpResponse(request, response);\n    });\n    request.on('error', function (error) {\n      return _this._onHttpRequestError(request, error);\n    });\n    this.upload._startUpload(request);\n    if (this._request === request) {\n      this._dispatchProgress('loadstart');\n    }\n  };\n  XMLHttpRequest.prototype._finalizeHeaders = function () {\n    this._headers = __assign({}, this._headers, {\n      Connection: 'keep-alive',\n      Host: this._url.host,\n      'User-Agent': this._userAgent\n    }, this._anonymous ? {\n      Referer: 'about:blank'\n    } : {});\n    this.upload._finalizeHeaders(this._headers, this._loweredHeaders);\n  };\n  XMLHttpRequest.prototype._onHttpResponse = function (request, response) {\n    var _this = this;\n    if (this._request !== request) {\n      return;\n    }\n    if (this.withCredentials && (response.headers['set-cookie'] || response.headers['set-cookie2'])) {\n      XMLHttpRequest.cookieJar.setCookies(response.headers['set-cookie'] || response.headers['set-cookie2']);\n    }\n    if ([301, 302, 303, 307, 308].indexOf(response.statusCode) >= 0) {\n      this._url = this._parseUrl(response.headers.location);\n      this._method = 'GET';\n      if (this._loweredHeaders['content-type']) {\n        delete this._headers[this._loweredHeaders['content-type']];\n        delete this._loweredHeaders['content-type'];\n      }\n      if (this._headers['Content-Type'] != null) {\n        delete this._headers['Content-Type'];\n      }\n      delete this._headers['Content-Length'];\n      this.upload._reset();\n      this._finalizeHeaders();\n      this._sendHxxpRequest();\n      return;\n    }\n    this._response = response;\n    this._response.on('data', function (data) {\n      return _this._onHttpResponseData(response, data);\n    });\n    this._response.on('end', function () {\n      return _this._onHttpResponseEnd(response);\n    });\n    this._response.on('close', function () {\n      return _this._onHttpResponseClose(response);\n    });\n    this.responseUrl = this._url.href.split('#')[0];\n    this.status = response.statusCode;\n    this.statusText = http.STATUS_CODES[this.status];\n    this._parseResponseHeaders(response);\n    var lengthString = this._responseHeaders['content-length'] || '';\n    this._totalBytes = +lengthString;\n    this._lengthComputable = !!lengthString;\n    this._setReadyState(XMLHttpRequest.HEADERS_RECEIVED);\n  };\n  XMLHttpRequest.prototype._onHttpResponseData = function (response, data) {\n    if (this._response !== response) {\n      return;\n    }\n    this._responseParts.push(new Buffer(data));\n    this._loadedBytes += data.length;\n    if (this.readyState !== XMLHttpRequest.LOADING) {\n      this._setReadyState(XMLHttpRequest.LOADING);\n    }\n    this._dispatchProgress('progress');\n  };\n  XMLHttpRequest.prototype._onHttpResponseEnd = function (response) {\n    if (this._response !== response) {\n      return;\n    }\n    this._parseResponse();\n    this._request = null;\n    this._response = null;\n    this._setReadyState(XMLHttpRequest.DONE);\n    this._dispatchProgress('load');\n    this._dispatchProgress('loadend');\n  };\n  XMLHttpRequest.prototype._onHttpResponseClose = function (response) {\n    if (this._response !== response) {\n      return;\n    }\n    var request = this._request;\n    this._setError();\n    request.abort();\n    this._setReadyState(XMLHttpRequest.DONE);\n    this._dispatchProgress('error');\n    this._dispatchProgress('loadend');\n  };\n  XMLHttpRequest.prototype._onHttpTimeout = function (request) {\n    if (this._request !== request) {\n      return;\n    }\n    this._setError();\n    request.abort();\n    this._setReadyState(XMLHttpRequest.DONE);\n    this._dispatchProgress('timeout');\n    this._dispatchProgress('loadend');\n  };\n  XMLHttpRequest.prototype._onHttpRequestError = function (request, error) {\n    if (this._request !== request) {\n      return;\n    }\n    this._setError();\n    request.abort();\n    this._setReadyState(XMLHttpRequest.DONE);\n    this._dispatchProgress('error');\n    this._dispatchProgress('loadend');\n  };\n  XMLHttpRequest.prototype._dispatchProgress = function (eventType) {\n    var event = new XMLHttpRequest.ProgressEvent(eventType);\n    event.lengthComputable = this._lengthComputable;\n    event.loaded = this._loadedBytes;\n    event.total = this._totalBytes;\n    this.dispatchEvent(event);\n  };\n  XMLHttpRequest.prototype._setError = function () {\n    this._request = null;\n    this._response = null;\n    this._responseHeaders = null;\n    this._responseParts = null;\n  };\n  XMLHttpRequest.prototype._parseUrl = function (urlString, user, password) {\n    var absoluteUrl = this.nodejsBaseUrl == null ? urlString : url.resolve(this.nodejsBaseUrl, urlString);\n    var xhrUrl = url.parse(absoluteUrl, false, true);\n    xhrUrl.hash = null;\n    var _a = (xhrUrl.auth || '').split(':'),\n      xhrUser = _a[0],\n      xhrPassword = _a[1];\n    if (xhrUser || xhrPassword || user || password) {\n      xhrUrl.auth = (user || xhrUser || '') + \":\" + (password || xhrPassword || '');\n    }\n    return xhrUrl;\n  };\n  XMLHttpRequest.prototype._parseResponseHeaders = function (response) {\n    this._responseHeaders = {};\n    for (var name_1 in response.headers) {\n      var loweredName = name_1.toLowerCase();\n      if (this._privateHeaders[loweredName]) {\n        continue;\n      }\n      this._responseHeaders[loweredName] = response.headers[name_1];\n    }\n    if (this._mimeOverride != null) {\n      this._responseHeaders['content-type'] = this._mimeOverride;\n    }\n  };\n  XMLHttpRequest.prototype._parseResponse = function () {\n    var buffer = Buffer.concat(this._responseParts);\n    this._responseParts = null;\n    switch (this.responseType) {\n      case 'json':\n        this.responseText = null;\n        try {\n          this.response = JSON.parse(buffer.toString('utf-8'));\n        } catch (_a) {\n          this.response = null;\n        }\n        return;\n      case 'buffer':\n        this.responseText = null;\n        this.response = buffer;\n        return;\n      case 'arraybuffer':\n        this.responseText = null;\n        var arrayBuffer = new ArrayBuffer(buffer.length);\n        var view = new Uint8Array(arrayBuffer);\n        for (var i = 0; i < buffer.length; i++) {\n          view[i] = buffer[i];\n        }\n        this.response = arrayBuffer;\n        return;\n      case 'text':\n      default:\n        try {\n          this.responseText = buffer.toString(this._parseResponseEncoding());\n        } catch (_b) {\n          this.responseText = buffer.toString('binary');\n        }\n        this.response = this.responseText;\n    }\n  };\n  XMLHttpRequest.prototype._parseResponseEncoding = function () {\n    return /;\\s*charset=(.*)$/.exec(this._responseHeaders['content-type'] || '')[1] || 'utf-8';\n  };\n  XMLHttpRequest.ProgressEvent = progress_event_1.ProgressEvent;\n  XMLHttpRequest.InvalidStateError = errors_1.InvalidStateError;\n  XMLHttpRequest.NetworkError = errors_1.NetworkError;\n  XMLHttpRequest.SecurityError = errors_1.SecurityError;\n  XMLHttpRequest.SyntaxError = errors_1.SyntaxError;\n  XMLHttpRequest.XMLHttpRequestUpload = xml_http_request_upload_1.XMLHttpRequestUpload;\n  XMLHttpRequest.UNSENT = 0;\n  XMLHttpRequest.OPENED = 1;\n  XMLHttpRequest.HEADERS_RECEIVED = 2;\n  XMLHttpRequest.LOADING = 3;\n  XMLHttpRequest.DONE = 4;\n  XMLHttpRequest.cookieJar = Cookie.CookieJar();\n  return XMLHttpRequest;\n}(xml_http_request_event_target_1.XMLHttpRequestEventTarget);\nexports.XMLHttpRequest = XMLHttpRequest;\nXMLHttpRequest.prototype.nodejsHttpAgent = http.globalAgent;\nXMLHttpRequest.prototype.nodejsHttpsAgent = https.globalAgent;\nXMLHttpRequest.prototype.nodejsBaseUrl = null;","map":{"version":3,"sources":["../xml-http-request.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar http = require(\"http\");\nvar https = require(\"https\");\nvar os = require(\"os\");\nvar url = require(\"url\");\nvar progress_event_1 = require(\"./progress-event\");\nvar errors_1 = require(\"./errors\");\nvar xml_http_request_event_target_1 = require(\"./xml-http-request-event-target\");\nvar xml_http_request_upload_1 = require(\"./xml-http-request-upload\");\nvar Cookie = require(\"cookiejar\");\nvar XMLHttpRequest = /** @class */ (function (_super) {\n    __extends(XMLHttpRequest, _super);\n    function XMLHttpRequest(options) {\n        if (options === void 0) { options = {}; }\n        var _this = _super.call(this) || this;\n        _this.UNSENT = XMLHttpRequest.UNSENT;\n        _this.OPENED = XMLHttpRequest.OPENED;\n        _this.HEADERS_RECEIVED = XMLHttpRequest.HEADERS_RECEIVED;\n        _this.LOADING = XMLHttpRequest.LOADING;\n        _this.DONE = XMLHttpRequest.DONE;\n        _this.onreadystatechange = null;\n        _this.readyState = XMLHttpRequest.UNSENT;\n        _this.response = null;\n        _this.responseText = '';\n        _this.responseType = '';\n        _this.status = 0; // TODO: UNSENT?\n        _this.statusText = '';\n        _this.timeout = 0;\n        _this.upload = new xml_http_request_upload_1.XMLHttpRequestUpload();\n        _this.responseUrl = '';\n        _this.withCredentials = false;\n        _this._method = null;\n        _this._url = null;\n        _this._sync = false;\n        _this._headers = {};\n        _this._loweredHeaders = {};\n        _this._mimeOverride = null; // TODO: is type right?\n        _this._request = null;\n        _this._response = null;\n        _this._responseParts = null;\n        _this._responseHeaders = null;\n        _this._aborting = null; // TODO: type?\n        _this._error = null; // TODO: type?\n        _this._loadedBytes = 0;\n        _this._totalBytes = 0;\n        _this._lengthComputable = false;\n        _this._restrictedMethods = { CONNECT: true, TRACE: true, TRACK: true };\n        _this._restrictedHeaders = {\n            'accept-charset': true,\n            'accept-encoding': true,\n            'access-control-request-headers': true,\n            'access-control-request-method': true,\n            connection: true,\n            'content-length': true,\n            cookie: true,\n            cookie2: true,\n            date: true,\n            dnt: true,\n            expect: true,\n            host: true,\n            'keep-alive': true,\n            origin: true,\n            referer: true,\n            te: true,\n            trailer: true,\n            'transfer-encoding': true,\n            upgrade: true,\n            'user-agent': true,\n            via: true\n        };\n        _this._privateHeaders = { 'set-cookie': true, 'set-cookie2': true };\n        _this._userAgent = \"Mozilla/5.0 (\" + os.type() + \" \" + os.arch() + \") node.js/\" + process.versions.node + \" v8/\" + process.versions.v8;\n        _this._anonymous = options.anon || false;\n        return _this;\n    }\n    XMLHttpRequest.prototype.open = function (method, url, async, user, password) {\n        if (async === void 0) { async = true; }\n        method = method.toUpperCase();\n        if (this._restrictedMethods[method]) {\n            throw new XMLHttpRequest.SecurityError(\"HTTP method \" + method + \" is not allowed in XHR\");\n        }\n        ;\n        var xhrUrl = this._parseUrl(url, user, password);\n        if (this.readyState === XMLHttpRequest.HEADERS_RECEIVED || this.readyState === XMLHttpRequest.LOADING) {\n            // TODO(pwnall): terminate abort(), terminate send()\n        }\n        this._method = method;\n        this._url = xhrUrl;\n        this._sync = !async;\n        this._headers = {};\n        this._loweredHeaders = {};\n        this._mimeOverride = null;\n        this._setReadyState(XMLHttpRequest.OPENED);\n        this._request = null;\n        this._response = null;\n        this.status = 0;\n        this.statusText = '';\n        this._responseParts = [];\n        this._responseHeaders = null;\n        this._loadedBytes = 0;\n        this._totalBytes = 0;\n        this._lengthComputable = false;\n    };\n    XMLHttpRequest.prototype.setRequestHeader = function (name, value) {\n        if (this.readyState !== XMLHttpRequest.OPENED) {\n            throw new XMLHttpRequest.InvalidStateError('XHR readyState must be OPENED');\n        }\n        var loweredName = name.toLowerCase();\n        if (this._restrictedHeaders[loweredName] || /^sec-/.test(loweredName) || /^proxy-/.test(loweredName)) {\n            console.warn(\"Refused to set unsafe header \\\"\" + name + \"\\\"\");\n            return;\n        }\n        value = value.toString();\n        if (this._loweredHeaders[loweredName] != null) {\n            name = this._loweredHeaders[loweredName];\n            this._headers[name] = this._headers[name] + \", \" + value;\n        }\n        else {\n            this._loweredHeaders[loweredName] = name;\n            this._headers[name] = value;\n        }\n    };\n    XMLHttpRequest.prototype.send = function (data) {\n        if (this.readyState !== XMLHttpRequest.OPENED) {\n            throw new XMLHttpRequest.InvalidStateError('XHR readyState must be OPENED');\n        }\n        if (this._request) {\n            throw new XMLHttpRequest.InvalidStateError('send() already called');\n        }\n        switch (this._url.protocol) {\n            case 'file:':\n                return this._sendFile(data);\n            case 'http:':\n            case 'https:':\n                return this._sendHttp(data);\n            default:\n                throw new XMLHttpRequest.NetworkError(\"Unsupported protocol \" + this._url.protocol);\n        }\n    };\n    XMLHttpRequest.prototype.abort = function () {\n        if (this._request == null) {\n            return;\n        }\n        this._request.abort();\n        this._setError();\n        this._dispatchProgress('abort');\n        this._dispatchProgress('loadend');\n    };\n    XMLHttpRequest.prototype.getResponseHeader = function (name) {\n        if (this._responseHeaders == null || name == null) {\n            return null;\n        }\n        var loweredName = name.toLowerCase();\n        return this._responseHeaders.hasOwnProperty(loweredName)\n            ? this._responseHeaders[name.toLowerCase()]\n            : null;\n    };\n    XMLHttpRequest.prototype.getAllResponseHeaders = function () {\n        var _this = this;\n        if (this._responseHeaders == null) {\n            return '';\n        }\n        return Object.keys(this._responseHeaders).map(function (key) { return key + \": \" + _this._responseHeaders[key]; }).join('\\r\\n');\n    };\n    XMLHttpRequest.prototype.overrideMimeType = function (mimeType) {\n        if (this.readyState === XMLHttpRequest.LOADING || this.readyState === XMLHttpRequest.DONE) {\n            throw new XMLHttpRequest.InvalidStateError('overrideMimeType() not allowed in LOADING or DONE');\n        }\n        this._mimeOverride = mimeType.toLowerCase();\n    };\n    XMLHttpRequest.prototype.nodejsSet = function (options) {\n        this.nodejsHttpAgent = options.httpAgent || this.nodejsHttpAgent;\n        this.nodejsHttpsAgent = options.httpsAgent || this.nodejsHttpsAgent;\n        if (options.hasOwnProperty('baseUrl')) {\n            if (options.baseUrl != null) {\n                var parsedUrl = url.parse(options.baseUrl, false, true);\n                if (!parsedUrl.protocol) {\n                    throw new XMLHttpRequest.SyntaxError(\"baseUrl must be an absolute URL\");\n                }\n            }\n            this.nodejsBaseUrl = options.baseUrl;\n        }\n    };\n    XMLHttpRequest.nodejsSet = function (options) {\n        XMLHttpRequest.prototype.nodejsSet(options);\n    };\n    XMLHttpRequest.prototype._setReadyState = function (readyState) {\n        this.readyState = readyState;\n        this.dispatchEvent(new progress_event_1.ProgressEvent('readystatechange'));\n    };\n    XMLHttpRequest.prototype._sendFile = function (data) {\n        // TODO\n        throw new Error('Protocol file: not implemented');\n    };\n    XMLHttpRequest.prototype._sendHttp = function (data) {\n        if (this._sync) {\n            throw new Error('Synchronous XHR processing not implemented');\n        }\n        if (data && (this._method === 'GET' || this._method === 'HEAD')) {\n            console.warn(\"Discarding entity body for \" + this._method + \" requests\");\n            data = null;\n        }\n        else {\n            data = data || '';\n        }\n        this.upload._setData(data);\n        this._finalizeHeaders();\n        this._sendHxxpRequest();\n    };\n    XMLHttpRequest.prototype._sendHxxpRequest = function () {\n        var _this = this;\n        if (this.withCredentials) {\n            var cookie = XMLHttpRequest.cookieJar\n                .getCookies(Cookie.CookieAccessInfo(this._url.hostname, this._url.pathname, this._url.protocol === 'https:')).toValueString();\n            this._headers.cookie = this._headers.cookie2 = cookie;\n        }\n        var _a = this._url.protocol === 'http:' ? [http, this.nodejsHttpAgent] : [https, this.nodejsHttpsAgent], hxxp = _a[0], agent = _a[1];\n        var requestMethod = hxxp.request.bind(hxxp);\n        var request = requestMethod({\n            hostname: this._url.hostname,\n            port: +this._url.port,\n            path: this._url.path,\n            auth: this._url.auth,\n            method: this._method,\n            headers: this._headers,\n            agent: agent\n        });\n        this._request = request;\n        if (this.timeout) {\n            request.setTimeout(this.timeout, function () { return _this._onHttpTimeout(request); });\n        }\n        request.on('response', function (response) { return _this._onHttpResponse(request, response); });\n        request.on('error', function (error) { return _this._onHttpRequestError(request, error); });\n        this.upload._startUpload(request);\n        if (this._request === request) {\n            this._dispatchProgress('loadstart');\n        }\n    };\n    XMLHttpRequest.prototype._finalizeHeaders = function () {\n        this._headers = __assign({}, this._headers, { Connection: 'keep-alive', Host: this._url.host, 'User-Agent': this._userAgent }, this._anonymous ? { Referer: 'about:blank' } : {});\n        this.upload._finalizeHeaders(this._headers, this._loweredHeaders);\n    };\n    XMLHttpRequest.prototype._onHttpResponse = function (request, response) {\n        var _this = this;\n        if (this._request !== request) {\n            return;\n        }\n        if (this.withCredentials && (response.headers['set-cookie'] || response.headers['set-cookie2'])) {\n            XMLHttpRequest.cookieJar\n                .setCookies(response.headers['set-cookie'] || response.headers['set-cookie2']);\n        }\n        if ([301, 302, 303, 307, 308].indexOf(response.statusCode) >= 0) {\n            this._url = this._parseUrl(response.headers.location);\n            this._method = 'GET';\n            if (this._loweredHeaders['content-type']) {\n                delete this._headers[this._loweredHeaders['content-type']];\n                delete this._loweredHeaders['content-type'];\n            }\n            if (this._headers['Content-Type'] != null) {\n                delete this._headers['Content-Type'];\n            }\n            delete this._headers['Content-Length'];\n            this.upload._reset();\n            this._finalizeHeaders();\n            this._sendHxxpRequest();\n            return;\n        }\n        this._response = response;\n        this._response.on('data', function (data) { return _this._onHttpResponseData(response, data); });\n        this._response.on('end', function () { return _this._onHttpResponseEnd(response); });\n        this._response.on('close', function () { return _this._onHttpResponseClose(response); });\n        this.responseUrl = this._url.href.split('#')[0];\n        this.status = response.statusCode;\n        this.statusText = http.STATUS_CODES[this.status];\n        this._parseResponseHeaders(response);\n        var lengthString = this._responseHeaders['content-length'] || '';\n        this._totalBytes = +lengthString;\n        this._lengthComputable = !!lengthString;\n        this._setReadyState(XMLHttpRequest.HEADERS_RECEIVED);\n    };\n    XMLHttpRequest.prototype._onHttpResponseData = function (response, data) {\n        if (this._response !== response) {\n            return;\n        }\n        this._responseParts.push(new Buffer(data));\n        this._loadedBytes += data.length;\n        if (this.readyState !== XMLHttpRequest.LOADING) {\n            this._setReadyState(XMLHttpRequest.LOADING);\n        }\n        this._dispatchProgress('progress');\n    };\n    XMLHttpRequest.prototype._onHttpResponseEnd = function (response) {\n        if (this._response !== response) {\n            return;\n        }\n        this._parseResponse();\n        this._request = null;\n        this._response = null;\n        this._setReadyState(XMLHttpRequest.DONE);\n        this._dispatchProgress('load');\n        this._dispatchProgress('loadend');\n    };\n    XMLHttpRequest.prototype._onHttpResponseClose = function (response) {\n        if (this._response !== response) {\n            return;\n        }\n        var request = this._request;\n        this._setError();\n        request.abort();\n        this._setReadyState(XMLHttpRequest.DONE);\n        this._dispatchProgress('error');\n        this._dispatchProgress('loadend');\n    };\n    XMLHttpRequest.prototype._onHttpTimeout = function (request) {\n        if (this._request !== request) {\n            return;\n        }\n        this._setError();\n        request.abort();\n        this._setReadyState(XMLHttpRequest.DONE);\n        this._dispatchProgress('timeout');\n        this._dispatchProgress('loadend');\n    };\n    XMLHttpRequest.prototype._onHttpRequestError = function (request, error) {\n        if (this._request !== request) {\n            return;\n        }\n        this._setError();\n        request.abort();\n        this._setReadyState(XMLHttpRequest.DONE);\n        this._dispatchProgress('error');\n        this._dispatchProgress('loadend');\n    };\n    XMLHttpRequest.prototype._dispatchProgress = function (eventType) {\n        var event = new XMLHttpRequest.ProgressEvent(eventType);\n        event.lengthComputable = this._lengthComputable;\n        event.loaded = this._loadedBytes;\n        event.total = this._totalBytes;\n        this.dispatchEvent(event);\n    };\n    XMLHttpRequest.prototype._setError = function () {\n        this._request = null;\n        this._response = null;\n        this._responseHeaders = null;\n        this._responseParts = null;\n    };\n    XMLHttpRequest.prototype._parseUrl = function (urlString, user, password) {\n        var absoluteUrl = this.nodejsBaseUrl == null ? urlString : url.resolve(this.nodejsBaseUrl, urlString);\n        var xhrUrl = url.parse(absoluteUrl, false, true);\n        xhrUrl.hash = null;\n        var _a = (xhrUrl.auth || '').split(':'), xhrUser = _a[0], xhrPassword = _a[1];\n        if (xhrUser || xhrPassword || user || password) {\n            xhrUrl.auth = (user || xhrUser || '') + \":\" + (password || xhrPassword || '');\n        }\n        return xhrUrl;\n    };\n    XMLHttpRequest.prototype._parseResponseHeaders = function (response) {\n        this._responseHeaders = {};\n        for (var name_1 in response.headers) {\n            var loweredName = name_1.toLowerCase();\n            if (this._privateHeaders[loweredName]) {\n                continue;\n            }\n            this._responseHeaders[loweredName] = response.headers[name_1];\n        }\n        if (this._mimeOverride != null) {\n            this._responseHeaders['content-type'] = this._mimeOverride;\n        }\n    };\n    XMLHttpRequest.prototype._parseResponse = function () {\n        var buffer = Buffer.concat(this._responseParts);\n        this._responseParts = null;\n        switch (this.responseType) {\n            case 'json':\n                this.responseText = null;\n                try {\n                    this.response = JSON.parse(buffer.toString('utf-8'));\n                }\n                catch (_a) {\n                    this.response = null;\n                }\n                return;\n            case 'buffer':\n                this.responseText = null;\n                this.response = buffer;\n                return;\n            case 'arraybuffer':\n                this.responseText = null;\n                var arrayBuffer = new ArrayBuffer(buffer.length);\n                var view = new Uint8Array(arrayBuffer);\n                for (var i = 0; i < buffer.length; i++) {\n                    view[i] = buffer[i];\n                }\n                this.response = arrayBuffer;\n                return;\n            case 'text':\n            default:\n                try {\n                    this.responseText = buffer.toString(this._parseResponseEncoding());\n                }\n                catch (_b) {\n                    this.responseText = buffer.toString('binary');\n                }\n                this.response = this.responseText;\n        }\n    };\n    XMLHttpRequest.prototype._parseResponseEncoding = function () {\n        return /;\\s*charset=(.*)$/.exec(this._responseHeaders['content-type'] || '')[1] || 'utf-8';\n    };\n    XMLHttpRequest.ProgressEvent = progress_event_1.ProgressEvent;\n    XMLHttpRequest.InvalidStateError = errors_1.InvalidStateError;\n    XMLHttpRequest.NetworkError = errors_1.NetworkError;\n    XMLHttpRequest.SecurityError = errors_1.SecurityError;\n    XMLHttpRequest.SyntaxError = errors_1.SyntaxError;\n    XMLHttpRequest.XMLHttpRequestUpload = xml_http_request_upload_1.XMLHttpRequestUpload;\n    XMLHttpRequest.UNSENT = 0;\n    XMLHttpRequest.OPENED = 1;\n    XMLHttpRequest.HEADERS_RECEIVED = 2;\n    XMLHttpRequest.LOADING = 3;\n    XMLHttpRequest.DONE = 4;\n    XMLHttpRequest.cookieJar = Cookie.CookieJar();\n    return XMLHttpRequest;\n}(xml_http_request_event_target_1.XMLHttpRequestEventTarget));\nexports.XMLHttpRequest = XMLHttpRequest;\nXMLHttpRequest.prototype.nodejsHttpAgent = http.globalAgent;\nXMLHttpRequest.prototype.nodejsHttpsAgent = https.globalAgent;\nXMLHttpRequest.prototype.nodejsBaseUrl = null;\n//# sourceMappingURL=xml-http-request.js.map"]},"metadata":{},"sourceType":"script"}